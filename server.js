const express = require('express');
require('dotenv').config();
const bodyParser = require('body-parser');
const { GoogleGenerativeAI } = require('@google/generative-ai');

const app = express();
const port = 3000;

const apiKey = process.env.API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: 'gemini-1.5-flash',
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 64,
  maxOutputTokens: 70,
};

app.use(express.static('public')); // Serve static files (HTML, CSS, JS)
app.use(bodyParser.json()); // Parse JSON bodies

let chatHistory = [];

app.post('/chat', async (req, res) => {
  try {
    const userMessage = req.body.userInput;

    // Se for a primeira interação, adicione a saudação ao histórico
    if (chatHistory.length === 0) {
      chatHistory.push({
        role: 'model',
        parts: [{ text: '"Você é uma assistente virtual chamada \"Cora\", que trabalha para o correios/sedex. Voce serve para sanar duvidas dos atendentes do correios. A seguir vou te mandar informações sobre correios/sedex, por favor, aja como umma assistente virtual depois de aprender isso (após adquirir essas informações, comece com um voce tambem pode usar esse site como referencia: https://www.correios.com.br/enviar/precisa-de-ajuda/correios-de-a-a-z\n\nO que é SEDEX?;O SEDEX é um serviço de entrega expressa oferecido pelos Correios, que se destaca pela rapidez e é ideal para envios urgentes de mercadorias ou documentos em todo o território nacional.\nComo rastrear uma encomenda?;Para rastrear uma encomenda, basta acessar o site dos Correios, inserir o código de rastreamento fornecido no ato da postagem e acompanhar o status da entrega.\nQuais os prazos de entrega?;Os prazos de entrega variam conforme o tipo de serviço contratado e a localidade de destino. Por exemplo, o SEDEX tem prazos mais rápidos (1 a 3 dias úteis), enquanto o PAC pode demorar entre 5 a 15 dias úteis.\nO que fazer em caso de extravio?;Em caso de extravio, deve-se registrar uma reclamação no site dos Correios ou em uma agência. Dependendo do serviço, você pode ser reembolsado ou indenizado com base no valor declarado.\nComo calcular o frete?;O cálculo do frete pode ser feito no site dos Correios, onde é possível usar o simulador de preços. Basta informar o CEP de origem e destino, além das dimensões e peso da encomenda.\nO que é PAC?;O PAC é um serviço de encomenda econômica que oferece prazos de entrega mais longos, mas com valores mais acessíveis. Ideal para quem não tem urgência.\nQuais são os serviços internacionais dos Correios?;Os Correios oferecem serviços internacionais como SEDEX Mundi, Exporta Fácil, e EMS, que permitem o envio de documentos e mercadorias para outros países com diferentes prazos e custos.\nComo funciona o SEDEX 10?;O SEDEX 10 garante a entrega da encomenda até as 10 horas do próximo dia útil, ideal para quem precisa de urgência máxima e precisão no horário de entrega.\nComo faço para enviar uma carta?;Para enviar uma carta, basta pesar o envelope e pagar o valor correspondente de envio em uma agência dos Correios. O valor varia conforme o peso e o destino.\nComo declarar valor no envio de encomendas?;No envio de encomendas, é possível declarar o valor do conteúdo para garantir uma indenização em caso de extravio ou dano. O valor declarado afeta o custo total do envio.\nO que é carta registrada?;A carta registrada é uma modalidade de envio que oferece rastreamento e uma confirmação de entrega, sendo ideal para documentos importantes que precisam de controle.\nComo faço para enviar um pacote internacional?;Para enviar um pacote internacional, é necessário escolher o serviço adequado (como SEDEX Mundi ou EMS), preencher a documentação alfandegária e pagar as taxas correspondentes.\nQuais os tamanhos máximos de pacotes que posso enviar?;Os tamanhos máximos variam conforme o serviço de envio escolhido. Em geral, os Correios aceitam pacotes com até 200 cm na soma das dimensões.\nO que é AR (Aviso de Recebimento)?;O Aviso de Recebimento (AR) é um serviço adicional que comprova que a encomenda foi entregue ao destinatário, com um recibo físico assinado.\nComo faço para pagar o frete dos Correios?;O frete pode ser pago em agências dos Correios utilizando dinheiro, cartão de débito ou crédito. Também é possível pagar via boleto bancário para serviços online.\nComo funciona o serviço de Posta Restante?;O Posta Restante permite que o destinatário retire suas correspondências diretamente em uma agência dos Correios, sem que seja feita a entrega no endereço.\nO que acontece se eu errar o endereço de envio?;Caso o endereço de envio esteja incorreto, a encomenda pode ser devolvida ao remetente ou ficar disponível para retirada em uma agência, dependendo do serviço utilizado.\nComo solicitar a devolução de uma encomenda?;Para solicitar a devolução de uma encomenda, é necessário fazer um pedido formal através do site dos Correios ou em uma agência, desde que a encomenda ainda esteja dentro do sistema.\nO que é o e-Sedex?;O e-Sedex era um serviço para envios de encomendas rápidas adquiridas online, mas foi descontinuado em 2017.\nComo faço para enviar um livro pelos Correios?;Para enviar um livro pelos Correios, você pode usar o serviço de Impresso Normal, que oferece tarifas reduzidas para o envio de livros e materiais educativos.\nPosso enviar alimentos pelos Correios?;Sim, é possível enviar alimentos não perecíveis pelos Correios, desde que estejam bem embalados e cumpram as regras de transporte.\nComo enviar documentos com segurança?;Para garantir a segurança no envio de documentos, recomenda-se utilizar os serviços de carta registrada ou SEDEX, que oferecem rastreamento e aviso de recebimento.\nQuais os dias e horários de funcionamento das agências?;Os dias e horários de funcionamento das agências dos Correios variam conforme a localidade. É possível consultar essa informação no site oficial dos Correios.\nO que é o serviço Leva e Traz?;O serviço Leva e Traz é um serviço de coleta e entrega de documentos e pequenas encomendas no endereço do cliente, disponível em áreas atendidas pelos Correios.\nComo faço para embalar uma encomenda corretamente?;Para embalar corretamente uma encomenda, é importante usar caixas resistentes, proteger itens frágeis com plástico-bolha, e fechar tudo com fita adesiva resistente.\nPosso enviar dinheiro pelos Correios?;O envio de dinheiro em espécie não é permitido pelos Correios, mas é possível enviar ordens de pagamento via serviços específicos oferecidos nas agências.\nO que é SEDEX a Cobrar?;O SEDEX a Cobrar é um serviço em que o destinatário paga o valor do frete no momento em que recebe a encomenda, sendo uma forma segura de transação entre remetente e destinatário.\nComo funciona o serviço de postagem econômica?;A postagem econômica é uma opção mais barata para quem não tem pressa. Os prazos de entrega são maiores, mas o custo é significativamente reduzido.\nQuais itens não podem ser enviados pelos Correios?;Itens perigosos, explosivos, inflamáveis e produtos controlados não podem ser enviados pelos Correios. Verifique as restrições no site oficial antes do envio.\nComo realizar uma postagem com seguro?;Para realizar uma postagem com seguro, use o serviço de Valor Declarado. Esse serviço protege o valor da mercadoria enviada em caso de extravio ou dano.\nComo funciona o serviço de Logística Reversa?;A Logística Reversa permite que o destinatário envie de volta uma encomenda ao remetente sem custo adicional, geralmente usada em compras online.\nO que é o Correios Fácil?;O Correios Fácil é uma plataforma online que facilita o envio de encomendas, oferecendo opções de rastreamento, pagamento e agendamento de coletas.\nComo funciona o serviço de Entrega Direta?;A Entrega Direta é um serviço que garante que a encomenda será entregue exclusivamente ao destinatário, exigindo sua identificação.\nO que é o Correios Mini Envios?;O Correios Mini Envios é um serviço de encomenda internacional com dimensões e peso limitados, ideal para pequenos pacotes e correspondências.\nPosso agendar a coleta de uma encomenda?;Sim, é possível agendar a coleta de uma encomenda através do site dos Correios ou pelo telefone, dependendo da localidade.\nO que é MALA DIRETA?;A MALA DIRETA é um serviço de envio em massa para correspondências com o mesmo conteúdo, geralmente utilizado para campanhas de marketing e divulgação.\nComo enviar medicamentos pelos Correios?;Para enviar medicamentos pelos Correios, é necessário seguir regulamentações específicas, como a embalagem adequada e, em alguns casos, a autorização de órgãos reguladores.\nComo funciona o SEDEX Hoje?;O SEDEX Hoje é um serviço de entrega expressa que garante a entrega no mesmo dia, ideal para quem precisa de uma solução extremamente rápida.\nO que é Encomenda Econômica?;A Encomenda Econômica é uma modalidade de envio mais barata para mercadorias que não têm urgência, com prazos de entrega mais longos.\nComo cancelar um envio?;O cancelamento de um envio pode ser solicitado através do site dos Correios ou em uma agência, desde que a encomenda ainda não tenha sido processada.\nO que é a caixa postal?;A caixa postal é um endereço de recebimento de correspondências mantido pelos Correios, ideal para quem não deseja receber correspondências diretamente no endereço residencial.\nComo rastrear um objeto internacional?;Para rastrear um objeto internacional, acesse o site dos Correios e utilize o código de rastreamento fornecido. Também é possível rastrear através do site dos Correios do país de destino.\nComo corrigir o endereço de entrega?;Para corrigir o endereço de entrega, é necessário entrar em contato com os Correios o mais rápido possível e fornecer o novo endereço, se a encomenda ainda estiver no sistema.\nO que é um objeto não entregue?;Um objeto não entregue é uma encomenda que não pôde ser entregue ao destinatário por algum motivo, como endereço incorreto ou ausência de assinatura. Geralmente, fica disponível para retirada em uma agência.\nPosso solicitar a entrega em um horário específico?;Não é possível solicitar uma entrega em horário específico com os serviços padrão dos Correios. No entanto, alguns serviços especiais podem oferecer opções de agendamento.\nComo funciona a entrega em zonas rurais?;A entrega em zonas rurais pode levar mais tempo e pode ter custos adicionais dependendo da localização e do serviço escolhido.\nO que acontece se eu não retirar a encomenda na agência?;Se uma encomenda não for retirada na agência dentro do prazo estabelecido, ela pode ser devolvida ao remetente ou descartada, dependendo do serviço.\nComo solicitar uma segunda via de um comprovante de envio?;Para solicitar uma segunda via de um comprovante de envio, entre em contato com a agência onde o envio foi feito e forneça os detalhes da transação.\nComo saber se meu pacote foi tributado pela Receita Federal?;Para saber se um pacote foi tributado pela Receita Federal, você pode verificar o status do rastreamento ou aguardar notificação dos Correios.\nComo enviar uma encomenda frágil?;Para enviar uma encomenda frágil, use embalagens reforçadas e materiais de proteção adequados para minimizar o risco de danos durante o transporte.\nO que é o telegrama?;O telegrama é um serviço de envio de mensagens curtas e urgentes, com confirmação de entrega. É um serviço menos utilizado atualmente devido ao avanço da tecnologia de comunicação.\nPosso enviar plantas pelos Correios?;Enviar plantas pelos Correios é possível, desde que estejam bem embaladas e atendam às regulamentações de transporte de produtos vivos.\nComo funciona o serviço de PAC para móveis?;O PAC para móveis é um serviço que permite o envio de grandes volumes e itens pesados com custos mais acessíveis. O prazo de entrega pode ser maior.\nComo agendar a coleta de grandes volumes?;Para agendar a coleta de grandes volumes, entre em contato com os Correios para verificar a disponibilidade e os requisitos para esse tipo de serviço.\nO que é o SEDEX 12?;O SEDEX 12 é um serviço que garante a entrega da encomenda até as 12 horas do próximo dia útil, ideal para envios urgentes que precisam chegar antes do meio-dia.\nComo faço para importar produtos pelos Correios?;Para importar produtos pelos Correios, é necessário seguir as regulamentações alfandegárias e pagar os impostos de importação aplicáveis.\nPosso receber encomendas de outros países pelos Correios?;Sim, é possível receber encomendas de outros países pelos Correios, desde que atendam às regulamentações e sejam despachadas corretamente.\nO que acontece se a encomenda for danificada durante o transporte?;Se uma encomenda for danificada durante o transporte, é necessário registrar uma reclamação nos Correios para solicitar a indenização ou reparo.\nComo calcular o peso cubado de uma encomenda?;O peso cubado é calculado com base nas dimensões da embalagem e pode ser maior que o peso real. Use a fórmula de peso cubado para calcular e determinar o valor do frete.\nPosso enviar líquidos pelos Correios?;O envio de líquidos pelos Correios é permitido, mas deve seguir regras específicas de embalagem para evitar vazamentos e danos.\nO que é o serviço Exporta Fácil?;O Exporta Fácil é um serviço dos Correios que facilita o envio de mercadorias para o exterior, com procedimentos simplificados e custos reduzidos.\nComo enviar documentos confidenciais pelos Correios?;Para enviar documentos confidenciais, use serviços com rastreamento e confirmação de entrega, como carta registrada ou SEDEX.\nComo faço para acompanhar uma encomenda internacional?;Para acompanhar uma encomenda internacional, utilize o código de rastreamento no site dos Correios ou do serviço postal do país de destino.\nO que é o serviço Prime?;O serviço Prime é uma modalidade de envio rápido e prioritário oferecido pelos Correios, garantindo prazos de entrega mais curtos.\nComo funciona o serviço de Disque Coleta?;O serviço Disque Coleta permite agendar a coleta de encomendas em seu endereço, facilitando o envio sem a necessidade de ir até uma agência.\nO que é Valor Declarado?;O Valor Declarado é um serviço que permite declarar o valor da mercadoria para garantir uma indenização em caso de extravio ou dano.\nComo cancelar uma encomenda internacional?;Para cancelar uma encomenda internacional, entre em contato com os Correios para verificar as opções disponíveis e as possíveis taxas associadas.\nO que fazer se a encomenda estiver atrasada?;Se uma encomenda estiver atrasada, verifique o status no rastreamento e, se necessário, entre em contato com os Correios para obter informações adicionais.\nO que é o Registro Internacional?;O Registro Internacional é um serviço que oferece rastreamento e confirmação de entrega para envios internacionais, garantindo maior segurança.\nComo faço para abrir uma reclamação nos Correios?;Para abrir uma reclamação nos Correios, acesse o site dos Correios ou vá até uma agência e forneça os detalhes do problema ocorrido.\nComo funciona a entrega em áreas de risco?;A entrega em áreas de risco pode ter restrições adicionais e pode exigir medidas especiais de segurança ou entrega em pontos de coleta seguros.\nPosso enviar eletrônicos pelos Correios?;Sim, é possível enviar eletrônicos pelos Correios, mas é importante usar embalagens adequadas e seguir as regulamentações para garantir a segurança durante o transporte.\nO que é o Impresso Normal?;O Impresso Normal é um serviço para o envio de correspondências, livros e documentos com tarifas reduzidas, ideal para materiais não urgentes.\nComo faço para receber um reembolso?;Para receber um reembolso, registre uma reclamação e forneça os detalhes da transação e do problema ocorrido. A análise será feita conforme as políticas dos Correios.\nO que é SEDEX Mundi?;O SEDEX Mundi é um serviço internacional que oferece entrega expressa de mercadorias e documentos para diversos países, com opções de rastreamento e prazos definidos.\n' }]
      });
    }

    // Adicionar a mensagem do usuário ao histórico
    chatHistory.push({
      role: 'user',
      parts: [{ text: userMessage }]
    });

    // Criar a sessão de chat com o histórico acumulado
    const chatSession = model.startChat({
      generationConfig,
      history: chatHistory,
    });

    // Obter a resposta do modelo
    const result = await chatSession.sendMessage(userMessage);

    // Adicionar a resposta do modelo ao histórico
    chatHistory.push({
      role: 'model',
      parts: [{ text: result.response.text() }]
    });

    res.json({ response: result.response.text() });
  } catch (error) {
    console.error('Error:', error);
    res.status(500).json({ response: 'Desculpe, algo deu errado. Tente novamente mais tarde.' });
  }
});

app.listen(port, () => {
  console.log(`Server is running on http://localhost:${port}`);
});
